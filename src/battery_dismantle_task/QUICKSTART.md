# Battery Dismantle Task - å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ ä¸€é”®å¯åŠ¨ç³»ç»Ÿï¼ˆæ¨èï¼‰

### å¯åŠ¨æ‰€æœ‰ç»„ä»¶

```bash
cd /home/olivia/llms-ros2/src/battery_dismantle_task
./start_system.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. âœ… æ£€æŸ¥å¹¶å¯åŠ¨ Ollama æœåŠ¡
2. âœ… éªŒè¯ LLM æ¨¡å‹ (gemma2:9b)
3. âœ… å¯åŠ¨ ROS2 ä»¿çœŸç³»ç»Ÿ (MoveIt + RViz)
4. âœ… å¯åŠ¨ Web UI (Gradioç•Œé¢)

**å¯åŠ¨æ—¶é—´**: ~20ç§’

### åœæ­¢æ‰€æœ‰ç»„ä»¶

```bash
cd /home/olivia/llms-ros2/src/battery_dismantle_task
./stop_system.sh
```

---

## ğŸ“– æ‰‹åŠ¨å¯åŠ¨ï¼ˆåˆ†æ­¥ï¼‰

å¦‚æœéœ€è¦åˆ†åˆ«æ§åˆ¶å„ä¸ªç»„ä»¶ï¼š

### ç»ˆç«¯1: å¯åŠ¨Ollama

```bash
# æ£€æŸ¥æ˜¯å¦å·²è¿è¡Œ
pgrep ollama

# å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œå¯åŠ¨å®ƒ
ollama serve
```

### ç»ˆç«¯2: å¯åŠ¨ROS2ç³»ç»Ÿ

```bash
cd /home/olivia/llms-ros2
source /opt/ros/humble/setup.bash
source install/setup.bash
ros2 launch battery_dismantle_task fake_execution.launch.py start_skill_server:=true
```

### ç»ˆç«¯3: å¯åŠ¨Web UI

```bash
cd /home/olivia/llms-ros2/src/battery_dismantle_task/llm_agent
python3 web_ui.py
```

---

## ğŸ¯ ä½¿ç”¨ç³»ç»Ÿ

### 1. æ‰“å¼€Webç•Œé¢

æµè§ˆå™¨è®¿é—®: **http://localhost:7860**

### 2. åˆå§‹åŒ–ç³»ç»Ÿ

ç‚¹å‡» **"Initialize System"** æŒ‰é’®ï¼Œç­‰å¾…çœ‹åˆ°ï¼š
```
âœ… System initialized successfully!
```

### 3. è¾“å…¥è‡ªç„¶è¯­è¨€æŒ‡ä»¤

#### åŸºç¡€æŒ‡ä»¤ç¤ºä¾‹ï¼š

**ç§»åŠ¨å‘½ä»¤ï¼š**
- `Go to home position`
- `Move to observation position`
- `Return to safe position`

**å¤¹çˆªæ§åˆ¶ï¼š**
- `Open the gripper`
- `Close the gripper`

**æŠ“å–æ“ä½œï¼š**
- `Pick up the bolt`
- `Grasp the top cover bolts`
- `Grab the battery`

**å®Œæ•´ä»»åŠ¡ï¼š**
- `Disassemble the battery`
- `Remove the bolt and place it in the tray`
- `Pick up the battery and move it to the container`

### 4. è§‚å¯Ÿæ‰§è¡Œ

- **Web UI**: æ˜¾ç¤ºæ‰§è¡Œæ—¥å¿—å’Œè®¡åˆ’
- **RVizçª—å£**: å®æ—¶æ˜¾ç¤ºæœºæ¢°è‡‚è¿åŠ¨
- **ç»ˆç«¯2**: æ˜¾ç¤ºè¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—

---

## ğŸ” ç³»ç»ŸçŠ¶æ€æ£€æŸ¥

### æ£€æŸ¥Ollamaæ˜¯å¦è¿è¡Œ

```bash
pgrep ollama
# æˆ–
curl http://localhost:11434/api/tags
```

### æ£€æŸ¥ROS2èŠ‚ç‚¹

```bash
ros2 node list
```

åº”è¯¥çœ‹åˆ°ï¼š
- `/robot_state_publisher`
- `/move_group`
- `/rviz2`
- `/skill_server`
- `/visual_state_manager`

### æ£€æŸ¥Web UIç«¯å£

```bash
netstat -tuln | grep 7860
# æˆ–
ss -tuln | grep 7860
```

### æµ‹è¯•LLMè¿æ¥

```bash
cd /home/olivia/llms-ros2/src/battery_dismantle_task/llm_agent
python3 -c "
from llm_client import LLMClient
import asyncio

async def test():
    client = LLMClient(backend='ollama')
    response = await client.generate('Say hello')
    print(response)

asyncio.run(test())
"
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: Ollamaè¿æ¥å¤±è´¥

**ç—‡çŠ¶**: Web UIæ˜¾ç¤º "Using demo plan..." æˆ–è§„åˆ’å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥Ollamaæ˜¯å¦è¿è¡Œ
pgrep ollama

# å¦‚æœæ²¡æœ‰ï¼Œå¯åŠ¨å®ƒ
ollama serve
```

### é—®é¢˜2: RVizæ˜¾ç¤ºä¸¤ä¸ªæœºå™¨äºº

**è§£å†³æ–¹æ¡ˆ**: å‚è€ƒ `fix_rviz_double_robot.md`

### é—®é¢˜3: Web UIæ— æ³•è¿æ¥åˆ°ROS2

**ç—‡çŠ¶**: ç‚¹å‡»"Initialize System"å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ROS2ç³»ç»Ÿå·²å¯åŠ¨ï¼ˆç»ˆç«¯2ï¼‰
2. æ£€æŸ¥skill_serveræ˜¯å¦è¿è¡Œï¼š
   ```bash
   ros2 node list | grep skill_server
   ```
3. ç­‰å¾…3ç§’è®©skill_serverå®Œå…¨å¯åŠ¨

### é—®é¢˜4: æŒ‡ä»¤æ‰§è¡Œä¸åŒ¹é…

**ç—‡çŠ¶**: "Go to home" æ‰§è¡Œäº†é”™è¯¯çš„åŠ¨ä½œ

**åŸå› **: Ollamaæ²¡æœ‰è¿è¡Œï¼Œç³»ç»Ÿä½¿ç”¨äº†demoè®¡åˆ’

**è§£å†³æ–¹æ¡ˆ**:
1. å¯åŠ¨Ollama: `ollama serve`
2. é‡å¯Web UI

### é—®é¢˜5: æ¨¡å‹ä¸‹è½½æ…¢

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼ˆæ›´å¿«ï¼‰
ollama pull gemma2:2b

# ä¿®æ”¹ llm_agent/llm_client.py ä¸­çš„é»˜è®¤æ¨¡å‹
# å°† "gemma2:9b" æ”¹ä¸º "gemma2:2b"
```

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥ (Web UI)                           â”‚
â”‚  http://localhost:7860                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LLMè§„åˆ’å™¨ (Ollama)                         â”‚
â”‚  - æ¨¡å‹: gemma2:9b                           â”‚
â”‚  - ç«¯å£: 11434                               â”‚
â”‚  - è‡ªç„¶è¯­è¨€ â†’ JSONè®¡åˆ’                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŒå±‚éªŒè¯å™¨ (Validator)                      â”‚
â”‚  - SchemaéªŒè¯                                â”‚
â”‚  - å®‰å…¨è§„åˆ™æ£€æŸ¥                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡Œå™¨ (Executor)                           â”‚
â”‚  - å‘å¸ƒ: /llm_commands                       â”‚
â”‚  - è®¢é˜…: /llm_feedback                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŠ€èƒ½æœåŠ¡å™¨ (Skill Server) - C++             â”‚
â”‚  - 20+æœºå™¨äººæŠ€èƒ½                             â”‚
â”‚  - MoveItè¿åŠ¨è§„åˆ’                            â”‚
â”‚  - å¤¹çˆªæ§åˆ¶                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»¿çœŸ/ç¡¬ä»¶                                    â”‚
â”‚  - Fake Execution (å½“å‰)                    â”‚
â”‚  - Real Robot (å¯é€‰)                        â”‚
â”‚  - RVizå¯è§†åŒ–                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ç”¨é€” | ä½ç½® |
|------|------|------|
| `skills.json` | å®šä¹‰å¯ç”¨çš„æœºå™¨äººæŠ€èƒ½ | `llm_agent/config/` |
| `safety.yaml` | å®‰å…¨çº¦æŸå’Œç¦æ­¢åºåˆ— | `llm_agent/config/` |
| `prompt.txt` | LLMç³»ç»Ÿæç¤ºè¯æ¨¡æ¿ | `llm_agent/config/` |
| `waypoints.json` | æœºå™¨äººå§¿æ€å®šä¹‰ | `config/` |
| `moveit.rviz` | RVizå¯è§†åŒ–é…ç½® | `config/` |

---

## ğŸ“ è¿›é˜¶ä½¿ç”¨

### ä¿®æ”¹LLMåç«¯

ç¼–è¾‘ `llm_agent/web_ui.py` ç¬¬29è¡Œï¼š

```python
# ä½¿ç”¨Ollamaï¼ˆæœ¬åœ°ï¼‰
self.planner = Planner(backend="ollama")

# æˆ–ä½¿ç”¨OpenAIï¼ˆäº‘ç«¯ï¼‰
self.planner = Planner(backend="chutes")
```

### æ·»åŠ æ–°çš„æœºå™¨äººå§¿æ€

ç¼–è¾‘ `config/waypoints.json`ï¼š

```json
{
  "HOME": [0.0, 0.2618, 3.14159, -2.2689, 0.0, 0.9599, 1.5708],
  "my_new_pose": [0.5, 0.3, 3.0, -2.0, 0.1, 1.0, 1.6]
}
```

### æ·»åŠ æ–°çš„å®‰å…¨è§„åˆ™

ç¼–è¾‘ `llm_agent/config/safety.yaml`ï¼š

```yaml
forbidden_sequences:
  - ["grasp", "grasp"]        # ç¦æ­¢è¿ç»­æŠ“å–
  - ["release", "release"]    # ç¦æ­¢è¿ç»­é‡Šæ”¾
  - ["my_custom_rule"]        # è‡ªå®šä¹‰è§„åˆ™
```

---

## ğŸ“ è·å–å¸®åŠ©

- **é¡¹ç›®æ–‡æ¡£**: `EXPERIMENT_DESIGN.md`
- **RVizé—®é¢˜**: `fix_rviz_double_robot.md`
- **æµ‹è¯•è„šæœ¬**: `test_ui_command_matching.py`

---

## âœ… æ£€æŸ¥æ¸…å•

å¯åŠ¨ç³»ç»Ÿå‰ç¡®è®¤ï¼š

- [ ] Ubuntu 22.04 + ROS2 Humbleå·²å®‰è£…
- [ ] é¡¹ç›®å·²ç¼–è¯‘ (`colcon build`)
- [ ] Ollamaå·²å®‰è£… (`which ollama`)
- [ ] æ¨¡å‹å·²ä¸‹è½½ (`ollama list | grep gemma2`)
- [ ] å›¾å½¢ç•Œé¢å¯ç”¨ï¼ˆRVizéœ€è¦ï¼‰

å¯åŠ¨ç³»ç»Ÿåç¡®è®¤ï¼š

- [ ] OllamaæœåŠ¡è¿è¡Œä¸­ (`pgrep ollama`)
- [ ] ROS2èŠ‚ç‚¹æ­£å¸¸ (`ros2 node list`)
- [ ] RVizçª—å£æ‰“å¼€
- [ ] Web UIå¯è®¿é—® (http://localhost:7860)
- [ ] æµ‹è¯•æŒ‡ä»¤æ‰§è¡Œæ­£å¸¸

---

**ç¥ä½¿ç”¨é¡ºåˆ©ï¼ğŸ‰**
