<?xml version="1.0"?>
<robot name="robotiq_2f_85_model" xmlns:xacro="http://ros.org/wiki/xacro">
  <!-- Fixed version of kortex's robotiq_2f_85_macro.xacro that doesn't pass
       isaac_joint_commands/isaac_joint_states to robotiq_gripper macro
       AND sets initial_value=0.0 (OPEN) to avoid self-collision -->
  <xacro:macro name="load_gripper" params="
    parent
    prefix
    use_fake_hardware:=false
    fake_sensor_commands:=false
    sim_ignition:=false
    sim_isaac:=false
    isaac_joint_commands:=/isaac_joint_commands
    isaac_joint_states:=/isaac_joint_states
    use_internal_bus_gripper_comm:=false
    com_port:=/dev/ttyUSB0
    moveit_active:=false">
    <xacro:include filename="$(find robotiq_description)/urdf/robotiq_2f_85_macro.urdf.xacro" />

    <!-- Hardware talks directly to the gripper so we don't need ros2_control unless we are simulating -->
    <xacro:property name="include_ros2_control" value="false"/>
    <xacro:if value="${sim_ignition or sim_isaac or use_fake_hardware or not use_internal_bus_gripper_comm}">
      <xacro:property name="include_ros2_control" value="true"/>
    </xacro:if>

    <!-- Use our custom ros2_control with initial_value=0.0 (OPEN) -->
    <xacro:include filename="$(find battery_dismantle_task)/grippers/robotiq_2f_85/urdf/robotiq_gripper.ros2_control.xacro" />

    <!-- Load robotiq gripper links and joints (without ros2_control) -->
    <!-- Gripper orientation: rotate 180Â° around X-axis to flip it upright -->
    <xacro:robotiq_gripper
        name="RobotiqGripperHardwareInterface"
        prefix="${prefix}"
        parent="${parent}"
        include_ros2_control="false"
        com_port="${com_port}"
        use_fake_hardware="${use_fake_hardware}"
        fake_sensor_commands="${fake_sensor_commands}"
        sim_ignition="${sim_ignition}"
        sim_isaac="${sim_isaac}">
        <origin xyz="0 0 0" rpy="3.14159265359 0 0" />
    </xacro:robotiq_gripper>

    <!-- Add our custom ros2_control with corrected initial_value -->
    <xacro:if value="${include_ros2_control}">
      <xacro:robotiq_gripper_ros2_control
          name="RobotiqGripperHardwareInterface"
          prefix="${prefix}"
          sim_ignition="${sim_ignition}"
          sim_isaac="${sim_isaac}"
          use_fake_hardware="${use_fake_hardware}"
          fake_sensor_commands="${fake_sensor_commands}"
          com_port="${com_port}" />
    </xacro:if>
  </xacro:macro>
</robot>
